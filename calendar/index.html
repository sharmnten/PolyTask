<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PolyTask — Calendar</title>
  <link rel="manifest" href="../manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#4f46e5">
  <meta name="color-scheme" content="light dark">
  <script src="../js/theme-init.js"></script>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'><style>path{fill:%23465775}@media(prefers-color-scheme:dark){path{fill:%23a5b4fc}}</style><path d='M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 12l-10-5v2l10 5 10-5v-2l-2.5 1.25L12 11zm0 5l2.5-1.25L12 17l-10-5v2l10 5 10-5v-2l-2.5 1.25L12 16z'/></svg>">
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="./calendar.css">
  <script>window.APPWRITE_ENDPOINT = 'https://nyc.cloud.appwrite.io/v1';</script>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@21.4.0"></script>
  <script type="module" src="../js/main.js"></script>
</head>
<body>
  <main class="card calendar-large" style="margin-top:2rem;">
      <div class="page-header">
        <h1>Planner</h1>
        <div class="page-header_actions">
             <label style="cursor:pointer; display:flex; align-items:center;" title="Toggle Dark Mode">
                 <input type="checkbox" id="dmToggle" style="display:none">
                 <svg viewBox="0 0 24 24" width="20" height="20" fill="none" class="dm-icon" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
             </label>
             <a href="../tasks/index.html" class="btn-outline" style="text-decoration:none;">Tasks</a>
             <a href="../dashboard/index.html" class="btn-outline" style="text-decoration:none;">Dashboard</a>
        </div>
      </div>
      <div class="nav-row">
        <button id="prevDay" class="btn-outline nav-day-btn prev">Prev day</button>
        <div id="currentDateDisplay"></div>
        <button id="nextDay" class="btn-outline nav-day-btn next">Next day</button>
        <!-- Auto-schedule runs automatically on task creation now -->
      </div>
    

  <div id="calendar" class="calendar-grid" aria-live="polite"></div>

  <!-- floating create button (use inline SVG for consistent centering) -->
  <div id="createTaskBtn-wrapper">
    <button id="createTaskBtn" title="Create task" class="icon-btn" aria-label="Create task">
      <!-- plus SVG -->
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" focusable="false">
        <path d="M11 11V5a1 1 0 1 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6z" fill="currentColor" />
      </svg>
    </button>
    <div id="createTaskBtn-popup">
      <span class="clock-icon">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true" focusable="false">
          <circle cx="12" cy="12" r="9" stroke="#888" stroke-width="2" fill="none" />
          <path d="M12 7v5l3 2" stroke="#888" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" />
        </svg>
      </span>
    </div>
  </div>

    <!-- creation modal -->
    <div
      id="taskModal"
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      aria-labelledby="taskModalTitle"
    >
      <div class="modal_panel modal_panel--narrow" role="document">
        <div class="modal_header">
          <div>
            <h2 id="taskModalTitle" class="modal_title">Create task</h2>
            <p class="modal_subtitle">Add a task and optionally a start time.</p>
          </div>
          <button type="button" id="closeTaskModal" class="icon-btn modal_close" aria-label="Close create task">×</button>
        </div>

        <form id="taskCreateForm">
          <div class="modal_body">
            <!-- Smart Input -->
            <div class="input-wrapper" style="margin-bottom:1rem;position:relative;">
              <input id="smartInput" type="text" placeholder=" " autocomplete="off" style="border-color:var(--violet);" />
              <label for="smartInput" style="color:var(--violet);">Smart Add (e.g. "Gym tomorrow 5pm")</label>
            </div>
            <div style="height:1px;background:#e5e7eb;margin-bottom:1rem;"></div>

            <div class="input-wrapper">
              <input id="taskTitle" name="name" type="text" required placeholder=" " />
              <label for="taskTitle">Title</label>
            </div>
            <div class="input-wrapper">
              <input id="taskDueDate" name="due" type="date" required placeholder=" " />
              <label for="taskDueDate">Due Date</label>
            </div>
            <div class="input-wrapper">
              <input id="taskAssignedTime" name="assignedTime" type="time" placeholder=" " />
              <label for="taskAssignedTime">Start Time (Optional)</label>
            </div>
            <div class="input-wrapper">
              <input id="taskEstimateMinutes" name="estimateMinutes" type="number" min="1" step="1" placeholder=" " />
              <label for="taskEstimateMinutes">Estimated time (minutes)</label>
            </div>
            <div class="input-wrapper">
              <select id="taskPriority" name="priority">
                <option value="high">High</option>
                <option value="medium" selected>Medium</option>
                <option value="low">Low</option>
              </select>
              <label for="taskPriority">Priority</label>
            </div>
          </div>

          <div class="modal_footer">
            <button type="button" id="cancelTask" class="btn-outline">Cancel</button>
            <button type="submit" class="btn">Save</button>
          </div>
        </form>
      </div>
    </div>

    <!-- define schedule modal -->
    <div
      id="defineScheduleModal"
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      aria-labelledby="scheduleTitle"
    >
      <div class="modal_panel modal_panel--wide" role="document">
        <div class="modal_header">
          <div>
            <h2 id="scheduleTitle" class="modal_title">Define Schedule</h2>
            <p class="modal_subtitle">Create repeatable blocked time ranges.</p>
          </div>
          <button type="button" id="closeScheduleModal" class="icon-btn modal_close" aria-label="Close schedule">×</button>
        </div>

        <form id="scheduleForm">
          <div class="modal_body">
            <p class="lead" style="margin-top:0;margin-bottom:.5rem;">Add one or more time ranges for each weekday. We'll create gray "Blocked time" events for this week.</p>
            <div class="schedule-grid">
            <div class="day-label">Sunday</div>
            <div class="day-intervals" data-day="0">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="0">+ Add time</button>
            </div>

            <div class="day-label">Monday</div>
            <div class="day-intervals" data-day="1">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="1">+ Add time</button>
            </div>

            <div class="day-label">Tuesday</div>
            <div class="day-intervals" data-day="2">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="2">+ Add time</button>
            </div>

            <div class="day-label">Wednesday</div>
            <div class="day-intervals" data-day="3">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="3">+ Add time</button>
            </div>

            <div class="day-label">Thursday</div>
            <div class="day-intervals" data-day="4">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="4">+ Add time</button>
            </div>

            <div class="day-label">Friday</div>
            <div class="day-intervals" data-day="5">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="5">+ Add time</button>
            </div>

            <div class="day-label">Saturday</div>
            <div class="day-intervals" data-day="6">
              <div class="intervals"></div>
              <button type="button" class="add-interval" data-day="6">+ Add time</button>
            </div>
            </div>
          </div>

          <div class="modal_footer modal_footer--split">
            <label class="switch-row">
              <span class="switch-row_text">Repeat weekly</span>
              <span class="switch">
                <input type="checkbox" id="repeatWeekly" checked aria-label="Repeat weekly">
                <span class="switch_track" aria-hidden="true"></span>
                <span class="switch_thumb" aria-hidden="true"></span>
              </span>
            </label>
            <div style="display:flex;gap:.5rem;justify-content:flex-end;">
              <button type="button" id="cancelSchedule" class="btn-outline">Cancel</button>
              <button type="submit" id="saveSchedule" class="btn">Save schedule</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- edit event modal -->
    <div
      id="editEventModal"
      class="modal"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      aria-labelledby="editEventTitle"
    >
      <div class="modal_panel modal_panel--wide" role="document">
        <div class="modal_header">
          <div>
            <h2 id="editEventTitle" class="modal_title">Edit event</h2>
            <p class="modal_subtitle">Update details, priority, and status.</p>
          </div>
          <button type="button" id="closeEditEvent" class="icon-btn modal_close" aria-label="Close edit event">×</button>
        </div>

        <form id="editEventForm">
          <div class="modal_body">
            <input type="hidden" id="editDocId" />

            <div class="input-wrapper">
              <input id="editTitle" type="text" required placeholder=" " />
              <label for="editTitle">Title</label>
            </div>

            <div class="input-row" style="display:flex;gap:.5rem;">
              <div class="input-wrapper" style="width:200px;">
                <input id="editDate" type="date" required placeholder=" " />
                <label for="editDate">Date</label>
              </div>
              <div class="input-wrapper" style="flex:1;">
                <input id="editStart" type="time" required placeholder=" " />
                <label for="editStart">Start</label>
              </div>
            </div>

            <div class="input-row" style="display:flex;gap:.5rem;">
              <div class="input-wrapper" style="flex:1;">
                <input id="editDuration" type="number" min="1" step="1" placeholder=" " />
                <label for="editDuration">Duration (min)</label>
              </div>
              <div class="input-wrapper" style="flex:1;">
                <input id="editColor" type="color" value="#3b82f6" />
                <label for="editColor">Color</label>
              </div>
            </div>

            <div class="input-row" style="display:flex;gap:.5rem;">
              <div class="input-wrapper" style="flex:1;">
                <select id="editPriority">
                  <option value="high">High</option>
                  <option value="medium" selected>Medium</option>
                  <option value="low">Low</option>
                </select>
                <label for="editPriority">Priority</label>
              </div>
              <div class="input-wrapper" style="flex:1;">
                <input id="editCategory" type="text" maxlength="20" placeholder=" " />
                <label for="editCategory">Category</label>
              </div>
            </div>

            <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px;gap:12px;flex-wrap:wrap;">
              <label class="switch-row">
                <span class="switch-row_text">Repeat weekly</span>
                <span class="switch">
                  <input id="editRepeatWeekly" type="checkbox" aria-label="Repeat weekly">
                  <span class="switch_track" aria-hidden="true"></span>
                  <span class="switch_thumb" aria-hidden="true"></span>
                </span>
              </label>
              <label class="switch-row">
                <span class="switch-row_text">Completed</span>
                <span class="switch">
                  <input id="editCompleted" type="checkbox" aria-label="Completed">
                  <span class="switch_track" aria-hidden="true"></span>
                  <span class="switch_thumb" aria-hidden="true"></span>
                </span>
              </label>
            </div>
          </div>

          <div class="modal_footer">
            <button type="button" id="cancelEditEvent" class="btn-outline">Cancel</button>
            <button type="submit" class="btn">Save</button>
          </div>
        </form>
      </div>
    </div>

  </main>
  
</body>
<footer>
    <p>2026 PolyTask. Made with &#10084; by Neal Sharma</p>
    <i class="fab fa-github"></i>
</footer>
</html>
